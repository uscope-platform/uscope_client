import{r as y,j as a,f as x,I as d,h as V,A as N,i as c,k as K,C as _,l as E,u as D,c as k,U as M,e as g,g as F}from"./index-a234ec4f.js";import{T as G}from"./TabbedContent-c09055d6.js";import{S as f}from"./ManagerToolbar-f6f5af79.js";let O=e=>{let m=Object.keys(e.programs).map(n=>({label:e.programs[n].name,value:e.programs[n].name})),o=e.core.default_program?{label:e.core.default_program,value:e.core.default_program}:void 0;const[i,r]=y.useState(o);let t=n=>{r(n),new c(e.application).edit_soft_core(e.core.id,"default_program",n.value).then(()=>{e.forceUpdate()})},u=n=>{(n.key==="Enter"||n.key==="Tab")&&new c(e.application).edit_soft_core(e.core.id,n.target.name,n.target.value).then(()=>{e.forceUpdate()})},b=n=>{new c(e.application).remove_soft_core(e.core.id).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.core.id,onRemove:b,children:[a.jsx(d,{inline:!0,ID:"id",name:"id",defaultValue:e.core.id,onKeyDown:u,label:"Core ID"}),a.jsx(d,{inline:!0,ID:"address",name:"address",defaultValue:e.core.address,onKeyDown:u,label:"Address"}),a.jsx(V,{label:"Default Program",onChange:t,value:i,defaultValue:"Select Program",name:"default_program",placeholder:"Default Program",options:m}),a.jsx(N,{forceUpdate:e.forceUpdate,application:e.application,core:e.core})]})},B=e=>{let m=i=>{(i.key==="Enter"||i.key==="Tab")&&new c(e.application).edit_misc_param(e.field.name,i.target.value,i.target.name==="name").then(()=>{e.forceUpdate()})},o=i=>{new c(e.application).remove_misc_field(e.field.name).then(()=>{e.forceUpdate()}),e.forceUpdate()};return a.jsxs(x,{name:e.field.name,onRemove:o,children:[a.jsx(d,{inline:!0,ID:"name",name:"name",defaultValue:e.field.name,onKeyDown:m,label:"Name"}),a.jsx(d,{inline:!0,ID:"value",name:"value",defaultValue:e.field.value,onKeyDown:m,label:"Value"})]})},L=e=>{let m=Object.entries(e.peripherals).map(n=>({label:n[0],value:n[0]}));const[o,i]=y.useState({label:e.peripheral.spec_id,value:e.peripheral.spec_id});let r=n=>{new c(e.application).edit_peripheral(e.peripheral.name,n.target.name,n.target.checked).then(()=>{e.forceUpdate()})},t=n=>{i(n),new c(e.application).edit_peripheral(e.peripheral.name,"spec_id",n.value).then(()=>{e.forceUpdate()})},u=n=>{(n.key==="Enter"||n.key==="Tab")&&new c(e.application).edit_peripheral(e.peripheral.name,n.target.name,n.target.value).then(()=>{e.forceUpdate()})},b=n=>{new c(e.application).remove_peripheral(e.peripheral.name).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.peripheral.name,onRemove:b,children:[a.jsx(d,{inline:!0,ID:"name",name:"name",defaultValue:e.peripheral.name,onKeyDown:u,label:"Name"}),a.jsx(d,{inline:!0,ID:"peripheral_id",name:"peripheral_id",defaultValue:e.peripheral.peripheral_id,onKeyDown:u,label:"Peripheral id"}),a.jsx(V,{label:"IP type",onChange:t,value:o,name:"spec_id",placeholder:"Peripheral type",options:m}),a.jsx(d,{inline:!0,ID:"base_address",name:"base_address",defaultValue:e.peripheral.base_address,onKeyDown:u,label:"Base Address"}),a.jsx(d,{inline:!0,ID:"type",name:"type",defaultValue:e.peripheral.type,onKeyDown:u,label:"Type"}),a.jsx(K,{name:"proxied",value:e.peripheral.proxied,onChange:r,label:"Proxied Peripheral"}),a.jsx(d,{inline:!0,ID:"proxy_address",name:"proxy_address",disabled:!e.peripheral.proxied,defaultValue:e.peripheral.proxy_address,onKeyDown:u,label:"Proxy Address"}),a.jsx(d,{inline:!0,ID:"proxy_type",name:"proxy_type",disabled:!e.peripheral.proxied,defaultValue:e.peripheral.proxy_type,onKeyDown:u,label:"Proxy Type"})]})},W=e=>{let m=i=>{(i.key==="Enter"||i.key==="Tab")&&new c(e.application).edit_irv(e.irv.address,i.target.name,i.target.value).then(()=>{e.forceUpdate()})},o=()=>{new c(e.application).remove_irv(e.irv.address).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.irv.address,onRemove:o,children:[a.jsx(d,{inline:!0,ID:"address",name:"address",defaultValue:e.irv.address,onKeyDown:m,label:"Address"}),a.jsx(d,{inline:!0,ID:"value",name:"value",defaultValue:e.irv.value,onKeyDown:m,label:"Value"})]})},q=e=>{let m=i=>{(i.key==="Enter"||i.key==="Tab")&&new c(e.application).edit_macro(e.macro.name,i.target.name,i.target.value).then(()=>{e.forceUpdate()})},o=i=>{new c(e.application).remove_macro(e.macro.name).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.macro.name,onRemove:o,children:[a.jsx(d,{inline:!0,ID:"name",name:"name",defaultValue:e.macro.name,onKeyDown:m,label:"Name"}),a.jsx(d,{inline:!0,ID:"trigger",name:"trigger",defaultValue:e.macro.trigger,onKeyDown:m,label:"Trigger"})]})},z=e=>{let m=r=>{new c(e.application).edit_parameters(e.parameter.parameter_id,r.name,r.checked).then(()=>{e.forceUpdate()})},o=r=>{(r.key==="Enter"||r.key==="Tab")&&new c(e.application).edit_parameters(e.parameter.parameter_id,r.target.name,r.target.value).then(()=>{e.forceUpdate()})},i=r=>{new c(e.application).remove_parameter(e.parameter.parameter_id).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.parameter.parameter_name,onRemove:i,selector:{name:"visible",label:"Visible",click:m,value:e.parameter.visible},children:[a.jsx(d,{inline:!0,ID:"parameter_name",name:"parameter_name",defaultValue:e.parameter.parameter_name,onKeyDown:o,label:"Name"}),a.jsx(d,{inline:!0,ID:"parameter_id",name:"parameter_id",defaultValue:e.parameter.parameter_id,onKeyDown:o,label:"Parameter ID"}),a.jsx(d,{inline:!0,ID:"trigger",name:"trigger",defaultValue:e.parameter.trigger,onKeyDown:o,label:"Trigger"}),a.jsx(d,{inline:!0,ID:"value",name:"value",defaultValue:e.parameter.value,onKeyDown:o,label:"Value"})]})},H=e=>{let m=r=>{new c(e.application).edit_channel(e.channel.name,r.name,r.checked).then(()=>{e.forceUpdate()})},o=r=>{(r.key==="Enter"||r.key==="Tab")&&new c(e.application).edit_channel(e.channel.name,r.target.name,r.target.value).then(()=>{e.forceUpdate()})},i=r=>{new c(e.application).remove_channel(e.channel.name).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.channel.name,onRemove:i,selector:{name:"enabled",label:"Enabled",click:m,value:e.channel.enabled},children:[a.jsx(d,{color:_.background.level_4,inline:!0,ID:"name",name:"name",defaultValue:e.channel.name,onKeyDown:o,label:"Name"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"id",name:"id",defaultValue:e.channel.id,onKeyDown:o,label:"Channel ID"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"number",name:"number",defaultValue:e.channel.number,onKeyDown:o,label:"Channel Number"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"mux_setting",name:"mux_setting",defaultValue:e.channel.mux_setting,onKeyDown:o,label:"Mux Setting"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"phys_width",name:"phys_width",defaultValue:e.channel.phys_width,onKeyDown:o,label:"Physical width"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"max_value",name:"max_value",defaultValue:e.channel.max_value,onKeyDown:o,label:"Maximum Value"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"min_value",name:"min_value",defaultValue:e.channel.min_value,onKeyDown:o,label:"Minimum Value"}),a.jsx(d,{color:_.background.level_4,inline:!0,ID:"scaling_factor",name:"scaling_factor",defaultValue:e.channel.scaling_factor,onKeyDown:o,label:"Scaling Factor"})]})},J=e=>{const[m,o]=y.useState(e.group.channels);let i=e.application.channels.map(n=>({label:n.name,value:n.id})),r=n=>{new c(e.application).edit_channel_group(e.group.group_name,n.name,n.checked).then(()=>{e.forceUpdate()})},t=n=>{n.length<=6&&(o(n),new c(e.application).edit_channel_group(e.group.group_name,"channels",n).then(()=>{e.forceUpdate()}))},u=n=>{(n.key==="Enter"||n.key==="Tab")&&new c(e.application).edit_channel_group(e.group.group_name,n.target.name,n.target.value).then(()=>{e.forceUpdate()})},b=()=>{new c(e.application).remove_channel_groups(e.group.group_name).then(()=>{e.forceUpdate()})};return a.jsxs(x,{name:e.group.group_name,onRemove:b,selector:{name:"default",label:"Enabled",click:r,value:e.group.Default},children:[a.jsx(d,{inline:!0,ID:"group_name",name:"group_name",defaultValue:e.group.group_name,onKeyDown:u,label:"Name"}),a.jsx(d,{inline:!0,ID:"group_id",name:"group_id",defaultValue:e.group.group_id,onKeyDown:u,label:"ID"}),a.jsx(E,{inline:!0,ID:"content",onChange:t,value:m,options:i,label:"Content"}),a.jsx(K,{ID:"default",name:"default",value:e.group.default,onChange:r,label:"Default group"})]})};const Q={channels:[],channel_groups:[],initial_registers_values:[],macro:[],parameters:[],peripherals:[],soft_cores:[]};let $=e=>{const m=D(l=>l.settings.selected_application),o=D(l=>l.applications),i=D(l=>l.peripherals),r=D(l=>l.programs),t=m?o[m]:Q;let[u,b]=y.useState(0);const[,n]=y.useReducer(l=>l+1,0),s=k.WidthProvider(k.Responsive);let C=(l,v)=>{let h=new c(t);switch(v){case"channel_group":h.add_channel_group(l).then();break;case"channel":h.add_channel(l).then();break;case"irv":h.add_irv(l).then();break;case"macro":h.add_macro(l).then();break;case"parameter":h.add_parameter(l).then();break;case"peripheral":h.add_peripheral(l).then();break;case"soft_core":h.add_soft_core(l).then();break;case"misc":h.set_misc_param(l).then();break;default:return}n()},p=(l,v,h)=>{let w=Object.values(v).map(A=>{const T=new RegExp("new_"+l+"_(\\d+)","g");let I=Array.from(A[h].matchAll(T),S=>S[1]);return I.length>0?I:null});w=w.filter(Boolean);let R="new_"+l+"_"+F(w.sort());C(R,l)},j=[];t&&(j=Object.keys(t).map((l,v)=>!Array.isArray(t[l])&&typeof t[l]!="function"?{name:l,value:t[l]}:null),j=j.filter(Boolean));let P=()=>[a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("channel",t.channels,"name")},contentName:"Channel"}),a.jsx(g,{children:t.channels.map(l=>a.jsx(H,{application:t,forceUpdate:n,channel:l},l.name))})]},"channels"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("channel_group",t.channel_groups,"group_name")},contentName:"Channel Group"}),a.jsx(g,{children:t.channel_groups.map(l=>a.jsx(J,{application:t,forceUpdate:n,group:l},l.name))})]},"channel_groups"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("irv",t.initial_registers_values,"address")},contentName:"Initial Register Value"}),a.jsx(g,{children:t.initial_registers_values.map(l=>a.jsx(W,{application:t,forceUpdate:n,irv:l},l.address))})]},"irvs"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("macro",t.macro,"name")},contentName:"Macro"}),a.jsx(g,{children:t.macro.map(l=>a.jsx(q,{application:t,forceUpdate:n,macro:l},l.name))})]},"macros"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("parameter",t.parameters,"parameter_name")},contentName:"Parameter"}),a.jsx(g,{children:t.parameters.map(l=>a.jsx(z,{application:t,forceUpdate:n,parameter:l},l.name))})]},"parameters"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("peripheral",t.peripherals,"name")},contentName:"Peripheral"}),a.jsx(g,{children:t.peripherals.map(l=>a.jsx(L,{application:t,peripherals:i,forceUpdate:n,peripheral:l},l.name))})]},"peripherals"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("soft_core",t.soft_cores,"id")},contentName:"Soft Core"}),a.jsx(g,{children:t.soft_cores.map(l=>a.jsx(O,{application:t,core:l,programs:r,forceUpdate:n},l.name))})]},"soft_cores"),a.jsxs("div",{children:[a.jsx(f,{onAdd:()=>{p("misc",j,"name")},contentName:"Miscellaneous Field"}),a.jsx(g,{children:j.map(l=>a.jsx(B,{application:t,forceUpdate:n,field:l},l.name))})]},"misc_fields")],U=()=>["Channels","Channel Groups","IRV","Macro","Parameters","Peripherals","Cores","Misc"];return a.jsx(s,{className:"layout",breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:24,md:20,sm:12,xs:8,xxs:4},useCSSTransforms:!1,children:a.jsx(M,{"data-grid":{x:0,y:0,w:24,h:6},level:"level_2",children:a.jsx(G,{names:U(),contents:P(),selected:u,onSelect:b})},"new_props")})};export{$ as default};
